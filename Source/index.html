<script>
function n2f(n) {
  return Math.pow(2, (n - 69) / 12) * 440;
}

function assert(predicat, msg) {
  if (!predicat) {
    throw msg;
  }
}

var params = {
  "kick": {
    "release": {
      "min": 0.0,
      "max": 10.0,
      "step": 0.01,
      "default": 1.0
    },
    "pitch": {
      "min": 30.,
      "max": 300.,
      "step": 1,
      "default": 80.
    },
    "squaremix": {
      "min": 0.0,
      "max": 2.0,
      "step": 0.01,
      "default": 0.3
    },
  },
  "snare": {
    "noise": {
      "min": 0.0,
      "max": 2.0,
      "step": 0.1,
      "default": 0.8
    },
    "pitch": {
      "min": 200.,
      "max": 1000.,
      "step": 1.,
      "default": 400.
    }
  },
  "sends": {
    "reverb": {
      "decay": {
        "min": 0.0,
        "max": 20.,
        "step": 0.1,
        "default":5.
      }
    },
    "delay": {
      "feedback": {
        "min": 0.0,
        "max": 150.,
        "step": 1.,
        "default":30.
      }
    }
  },
  "master": {
    "compression": {
      "ratio": {
        "min": 0.0,
        "max": 20.,
        "step": 0.1,
        "default":4.
      }
    }
  }
};
// map params to integers
var ws = new WebSocket("ws://localhost:7681", "tmpsnd");
ws.onopen = function(e) {
  ws.send(JSON.stringify(params));
}

// function registerInstrument(inst) {
//   instruments.push(inst);
// }
// 
// function triggerInstrument(tuple) {
//   inst[tuple[1]].play(tuple[0] /* delta t */,
//                       n2f(tuple[2]) /* note */,
//                       tuple[3] /* vel */);
// }
// 
// function registerParameters(param) {
//   assert(param instanceof AudioParam);
//   parameters.push(param);
// }
// 
// function setParameter(tuple) {
//   
// }
// 
// instruments = [
//   function kick()
// ]
// 
// tmpsnd = function() {
// }
// 
// 
// ws.onmessage = function(e) {
//   // in any case, tuple[0] is the time, tuple[1] is the index of the thing to
//   // touch
//   // for a param change, tuple[2] is the new value
//   // for a note trigger, tuple[2] is the note, tuple[3] is the velocity
//   var tuple = e.data.split(",");
//   switch (tuple.len) {
//     case 3: // parameter change
//       param(tuple);
//       break;
//     case 4: // note trigger
//       trigger(tuple);
//       break;
//     case 2: //note off
//       stop(tuple);
//       break;
//     default:
//       throw "weird message";
//   }
// }

</script>
